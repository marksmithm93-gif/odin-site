<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Plan | OdinXAI</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* Paste your standard CSS here */
        body { background: #0A0A0A; color: white; font-family: sans-serif; }
        .container { max-width: 900px; margin: 40px auto; display: grid; grid-template-columns: 1fr 1fr; gap: 40px;}
        select { width: 100%; padding: 10px; background: #1a1a1a; color: white; border: 1px solid #4DDF9C; }
        button { background: #4DDF9C; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; }
        .summary { background: #1a1a1a; padding: 20px; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <div>
            <h2 style="color: #4DDF9C;">Step 2: Activate Subscription</h2>
            <p>Your setup fee has been received. Select your monthly power level.</p>
            
            <label>Select Plan</label>
            <select id="plan-selector">
                <option value="Essential">Essential ($99/mo)</option>
                <option value="Growth" selected>Growth ($199/mo)</option>
                <option value="Scale">Scale ($299/mo)</option>
            </select>

            <div id="payment-element" style="margin-top: 20px;"></div>
            <div id="error-message" style="color: red;"></div>
        </div>

        <div class="summary">
            <h3>DEPLOYMENT MANIFEST</h3>
            <p>Setup Fee: <span style="color: #4DDF9C;">PAID ($499.00)</span></p>
            <p>Monthly Plan: <span id="summary-price">$199.00</span></p>
            <hr style="border-color: #333;">
            <h2>Due Now: <span id="summary-total">$199.00</span></h2>
            <button id="submit">Activate Account</button>
        </div>
    </div>

    <script>
        // REPLACE WITH YOUR PUBLISHABLE KEY
        const stripe = Stripe("pk_live_YOUR_KEY_HERE"); 

        const plans = {
            'Essential': 99,
            'Growth': 199,
            'Scale': 299
        };

        let elements, paymentElement;

        // Initialize with default plan (Growth)
        initialize('Growth');

        async function initialize(planName) {
            const response = await fetch("/.netlify/functions/create-payment-intent", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ plan: planName }), // Send Plan Name only
            });

            const { clientSecret } = await response.json();
            const appearance = { theme: 'night', variables: { colorPrimary: '#4DDF9C' } };

            if(paymentElement) paymentElement.unmount();
            
            elements = stripe.elements({ appearance, clientSecret });
            paymentElement = elements.create("payment");
            paymentElement.mount("#payment-element");
        }

        // Handle Plan Change
        document.getElementById('plan-selector').addEventListener('change', (e) => {
            const plan = e.target.value;
            const price = plans[plan];
            
            // Update Text
            document.getElementById('summary-price').textContent = `$${price}.00`;
            document.getElementById('summary-total').textContent = `$${price}.00`;
            
            // Re-load Stripe
            initialize(plan);
        });

        // Submit
        document.getElementById('submit').addEventListener('click', async () => {
            const { error } = await stripe.confirmPayment({
                elements,
                confirmParams: {
                    return_url: window.location.origin + "/thank-you.html",
                },
            });
            if (error) document.getElementById("error-message").textContent = error.message;
        });
    </script>
</body>
</html>
